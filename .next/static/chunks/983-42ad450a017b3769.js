"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{3999:(e,t,a)=>{a.d(t,{cn:()=>n});var r=a(2596),o=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.QP)((0,r.$)(t))}},5081:(e,t,a)=>{a.d(t,{bV:()=>u,Ad:()=>m,T8:()=>l,$D:()=>v,On:()=>g,r_:()=>_,ID:()=>f,Gf:()=>p,D:()=>h,tO:()=>y});var r=a(5317),o=a(3915),n=a(7505),i=a(5404);let d=(0,o.Wp)({apiKey:"AIzaSyAKy32t3h5bIC0T--o56m982hmeFBEbk0U",authDomain:"martinez-4ab8d.firebaseapp.com",projectId:"martinez-4ab8d",storageBucket:"martinez-4ab8d.firebasestorage.app",messagingSenderId:"79056089461",appId:"1:79056089461:web:e25bb5bf9b462e83ebe33c",measurementId:"G-W17EK3Z35K"}),s=(0,r.aU)(d);function c(e){let t;let a=new Date;if(e.always_active)return{valid:!0,qrCode:e,mode:"sign_in",message:"QR code is always active"};let r=e.week_start.toDate(),o=e.week_end.toDate();if(a<r||a>o)return{valid:!1,message:"QR code has expired",qrCode:e};let n=e.work_days.split(","),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()];if(!n.includes(i))return{valid:!1,message:"QR code is not active on this day",qrCode:e};let d=100*a.getHours()+a.getMinutes(),s=Number.parseInt(e.signin_hour.replace(":","")),c=Number.parseInt(e.inactive_hour.replace(":","")),l=Number.parseInt(e.signout_hour.replace(":",""));return"inactive"==(t=d>=s&&d<c?"sign_in":d>=c&&d<l?"sign_out":"inactive")?{valid:!1,message:"QR code is not active at this time",qrCode:e}:{valid:!0,qrCode:e,mode:t,message:"Ready for ".concat("sign_in"===t?"sign in":"sign out")}}async function l(){try{let e=(0,r.rJ)(s,"employees"),t=(0,r.P)(e,(0,r._M)("is_active","==",!0));return(await (0,r.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[v0] Error getting employees:",e),e}}async function u(e){try{let t=(0,r.rJ)(s,"employees"),a={employee_id:e.employee_id,name:e.name,email:e.email||"",department:e.department||"",position:e.position||"",is_active:!0,created_at:r.Dc.now()};return{lastID:(await (0,r.gS)(t,a)).id}}catch(e){throw console.error("[v0] Error creating employee:",e),e}}async function g(){try{let e=(0,r.rJ)(s,"qr_codes"),t=(0,r.P)(e,(0,r.AB)(1)),a=await (0,r.GG)(t);if(console.log("getCurrentQRCode: querySnapshot.empty:",a.empty),console.log("getCurrentQRCode: querySnapshot.docs:",a.docs.map(e=>e.data())),a.empty)return console.log("getCurrentQRCode: No active QR code found in database."),{valid:!1,message:"No active QR code found"};let o={id:a.docs[0].id,...a.docs[0].data()},n=c(o);return console.log("getCurrentQRCode: Validation result:",n),{...n,qrCode:o}}catch(e){return console.error("[v0] Error getting current QR code:",e),{valid:!1,message:"Error validating QR code"}}}async function m(e){try{var t;let a=(0,r.rJ)(s,"qr_codes"),o=(0,r.P)(a,(0,r._M)("is_active","==",!0)),n=(await (0,r.GG)(o)).docs.map(e=>(0,r.mZ)(e.ref,{is_active:!1}));await Promise.all(n);let i="QR_".concat(new Date().getFullYear()).concat(String(function(e){let t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),a=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-a);let r=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t.getTime()-r.getTime())/864e5+1)/7)}(new Date)).padStart(2,"0"),"_").concat(Date.now()),d=w(new Date),c=(t=new Date,new Date(w(t).getTime()+5184e5)),l={name:(null==e?void 0:e.name)||"Weekly QR Code - ".concat(new Date().toLocaleDateString()),code:i,week_start:r.Dc.fromDate(d),week_end:r.Dc.fromDate(c),is_active:!0,always_active:(null==e?void 0:e.always_active)||!1,created_at:r.Dc.now(),signin_hour:(null==e?void 0:e.signin_hour)||"08:00",signout_hour:(null==e?void 0:e.signout_hour)||"17:00",inactive_hour:(null==e?void 0:e.inactive_hour)||"12:00",work_days:(null==e?void 0:e.work_days)||"Monday,Tuesday,Wednesday,Thursday,Friday"},u=await (0,r.gS)(a,l);return{lastID:u.id,qrCode:{id:u.id,...l}}}catch(e){throw console.error("[v0] Error creating QR code:",e),e}}async function v(){try{let e=(0,r.rJ)(s,"qr_codes"),t=(0,r.P)(e,(0,r.My)("created_at","desc"));return(await (0,r.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){throw console.error("[v0] Error getting QR codes:",e),e}}async function y(e){try{let t=(0,r.rJ)(s,"qr_codes"),a=(0,r.P)(t,(0,r._M)("code","==",e),(0,r._M)("is_active","==",!0)),o=await (0,r.GG)(a);if(o.empty)return{valid:!1,message:"Invalid or expired QR code"};let n={id:o.docs[0].id,...o.docs[0].data()};return c(n)}catch(e){return console.error("[v0] Error validating QR code:",e),{valid:!1,message:"Error validating QR code"}}}async function p(e){try{let t=(0,r.rJ)(s,"signin_out_records"),a={employee_id:e.employee_id,qr_code_id:e.qrCodeId,action_type:e.actionType,timestamp:r.Dc.now(),ip_address:e.ipAddress||"",device_info:e.deviceInfo||"",selfie_data:e.selfieData||""};return{lastID:(await (0,r.gS)(t,a)).id}}catch(e){throw console.error("[v0] Error recording sign in/out:",e),e}}async function _(e){try{let t=(0,r.rJ)(s,"signin_out_records"),a=(0,r.P)(t,(0,r.My)("timestamp","desc"));(null==e?void 0:e.employeeId)&&(a=(0,r.P)(t,(0,r._M)("employee_id","==",e.employeeId),(0,r.My)("timestamp","desc")));let o=(await (0,r.GG)(a)).docs.map(e=>({id:e.id,...e.data()}));return await Promise.all(o.map(async e=>{try{let t=await (0,r.x7)((0,r.H9)(s,"employees",e.employee_id)),a=t.exists()?t.data():null,o=await (0,r.x7)((0,r.H9)(s,"qr_codes",e.qr_code_id)),n=o.exists()?o.data():null;return{...e,employee_name:(null==a?void 0:a.name)||"Unknown",employee_id:(null==a?void 0:a.employee_id)||"Unknown",qr_code:(null==n?void 0:n.code)||"Unknown",timestamp:e.timestamp.toDate().toISOString()}}catch(t){return console.error("[v0] Error enriching record:",t),{...e,employee_name:"Unknown",employee_id:"Unknown",qr_code:"Unknown",timestamp:e.timestamp.toDate().toISOString()}}}))}catch(e){throw console.error("[v0] Error getting records:",e),e}}async function f(){try{let e=(0,r.rJ)(s,"system_config"),t=await (0,r.GG)(e),a={signin_hour:"08:00",signout_hour:"17:00",inactive_hour:"12:00",work_days:"Monday,Tuesday,Wednesday,Thursday,Friday"};return t.docs.forEach(e=>{let t=e.data();a[t.config_key]=t.config_value}),a}catch(e){throw console.error("[v0] Error getting system config:",e),e}}async function h(e,t){try{let a=(0,r.rJ)(s,"system_config"),o=(0,r.P)(a,(0,r._M)("config_key","==",e)),n=await (0,r.GG)(o);if(n.empty)await (0,r.gS)(a,{config_key:e,config_value:t,updated_at:r.Dc.now()});else{let e=n.docs[0].ref;await (0,r.mZ)(e,{config_value:t,updated_at:r.Dc.now()})}return{success:!0}}catch(e){throw console.error("[v0] Error updating system config:",e),e}}function w(e){let t=new Date(e),a=t.getDay(),r=t.getDate()-a+(0===a?-6:1);return new Date(t.setDate(r))}(0,n.c7)(d),(0,i.xI)(d)},7168:(e,t,a)=>{a.d(t,{$:()=>s});var r=a(5155);a(2115);var o=a(6634),n=a(2085),i=a(3999);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function s(e){let{className:t,variant:a,size:n,asChild:s=!1,...c}=e,l=s?o.DX:"button";return(0,r.jsx)(l,{"data-slot":"button",className:(0,i.cn)(d({variant:a,size:n,className:t})),...c})}},8482:(e,t,a)=>{a.d(t,{BT:()=>s,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>i});var r=a(5155);a(2115);var o=a(3999);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,o.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,o.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,o.cn)("leading-none font-semibold",t),...a})}function s(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,o.cn)("text-muted-foreground text-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,o.cn)("px-6",t),...a})}}}]);