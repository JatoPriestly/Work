(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{646:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1007:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2893:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>h});var r=a(5155),t=a(2115),i=a(5695),n=a(8482),c=a(7168),l=a(8145),d=a(646),o=a(4861),u=a(1007),m=a(4355),x=a(5081);function h(){let e=(0,i.useParams)().qrCode,[s,a]=(0,t.useState)([]),[h,g]=(0,t.useState)(null),[f,v]=(0,t.useState)(null),[p,j]=(0,t.useState)(null),[y,b]=(0,t.useState)(!1),[N,k]=(0,t.useState)(null),w=(0,t.useRef)(null),S=(0,t.useRef)(null),[C,A]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{let s=await (0,x.tO)(e);if(!s.valid){k({success:!1,message:"Invalid or expired QR code"});return}v(s);let r=await (0,x.T8)();a(r)}catch(e){k({success:!1,message:"Failed to load employee data"})}})()},[e]);let _=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});w.current&&(w.current.srcObject=e,A(!0))}catch(e){console.error("Camera access denied:",e),k({success:!1,message:"Camera access required for selfie"})}},E=async()=>{if(h&&p&&h.id){b(!0);try{await (0,x.Gf)({employee_id:h.id,qrCodeId:e,actionType:f.mode,selfieData:p,ipAddress:"127.0.0.1",deviceInfo:navigator.userAgent}),k({success:!0,message:"Successfully ".concat("sign_in"===f.mode?"signed in":"signed out","!")})}catch(e){k({success:!1,message:"Failed to record attendance"})}finally{b(!1)}}};return N?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center p-4",children:(0,r.jsx)(n.Zp,{className:"w-full max-w-md text-center",children:(0,r.jsxs)(n.Wu,{className:"pt-6",children:[N.success?(0,r.jsx)(d.A,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}):(0,r.jsx)(o.A,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-bold mb-2",children:N.success?"Success!":"Error"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:N.message})]})})}):f?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-4",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,r.jsx)(n.Zp,{children:(0,r.jsxs)(n.aR,{className:"text-center",children:[(0,r.jsxs)(n.ZB,{className:"text-2xl font-bold",children:["Employee ","sign_in"===f.mode?"Sign In":"Sign Out"]}),(0,r.jsx)(l.E,{variant:"sign_in"===f.mode?"default":"secondary",className:"mx-auto",children:"sign_in"===f.mode?"Sign In Mode":"Sign Out Mode"})]})}),!h&&(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"h-5 w-5"}),"Select Your Name"]})}),(0,r.jsx)(n.Wu,{children:(0,r.jsx)("div",{className:"grid gap-2",children:s.filter(e=>e.id).map(e=>(0,r.jsx)(c.$,{variant:"outline",className:"justify-start h-auto p-4 bg-transparent",onClick:()=>g(e),children:(0,r.jsxs)("div",{className:"text-left",children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:e.department})]})},e.id))})})]}),h&&!p&&(0,r.jsxs)(n.Zp,{children:[(0,r.jsxs)(n.aR,{children:[(0,r.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-5 w-5"}),"Take Selfie"]}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Please take a selfie to complete your ","sign_in"===f.mode?"sign in":"sign out"]})]}),(0,r.jsxs)(n.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("p",{className:"font-medium mb-2",children:["Selected: ",h.name]}),(0,r.jsx)(l.E,{variant:"outline",children:h.department})]}),C?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("video",{ref:w,autoPlay:!0,playsInline:!0,className:"w-full rounded-lg"})}),(0,r.jsx)(c.$,{onClick:()=>{if(w.current&&S.current){let e=S.current,s=w.current,a=e.getContext("2d");e.width=s.videoWidth,e.height=s.videoHeight,null==a||a.drawImage(s,0,0),j(e.toDataURL("image/jpeg",.8));let r=s.srcObject;null==r||r.getTracks().forEach(e=>e.stop()),A(!1)}},className:"w-full",children:"Take Photo"})]}):(0,r.jsxs)(c.$,{onClick:_,className:"w-full",children:[(0,r.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Start Camera"]}),(0,r.jsx)("canvas",{ref:S,className:"hidden"})]})]}),h&&p&&(0,r.jsxs)(n.Zp,{children:[(0,r.jsx)(n.aR,{children:(0,r.jsxs)(n.ZB,{children:["Confirm ","sign_in"===f.mode?"Sign In":"Sign Out"]})}),(0,r.jsxs)(n.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("p",{className:"font-medium",children:h.name}),(0,r.jsx)(l.E,{variant:"outline",children:h.department})]}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("img",{src:p||"/placeholder.svg",alt:"Selfie",className:"w-32 h-32 rounded-full mx-auto object-cover border-4 border-primary"})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>j(null),className:"flex-1",children:"Retake Photo"}),(0,r.jsx)(c.$,{onClick:E,disabled:y,className:"flex-1",children:y?"Processing...":"Confirm ".concat("sign_in"===f.mode?"Sign In":"Sign Out")})]})]})]})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Validating QR code..."})]})})}},4355:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},4495:(e,s,a)=>{Promise.resolve().then(a.bind(a,2893))},4861:(e,s,a)=>{"use strict";a.d(s,{A:()=>r});let r=(0,a(9946).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},5695:(e,s,a)=>{"use strict";var r=a(8999);a.o(r,"useParams")&&a.d(s,{useParams:function(){return r.useParams}})},8145:(e,s,a)=>{"use strict";a.d(s,{E:()=>l});var r=a(5155);a(2115);var t=a(6634),i=a(2085),n=a(3999);let c=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:a,asChild:i=!1,...l}=e,d=i?t.DX:"span";return(0,r.jsx)(d,{"data-slot":"badge",className:(0,n.cn)(c({variant:a}),s),...l})}}},e=>{var s=s=>e(e.s=s);e.O(0,[135,965,578,983,441,684,358],()=>s(4495)),_N_E=e.O()}]);