(()=>{var e={};e.id=744,e.ids=[744],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19771:e=>{"use strict";e.exports=require("process")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},37366:e=>{"use strict";e.exports=require("dns")},44089:(e,r,t)=>{"use strict";t.d(r,{uQ:()=>p,On:()=>d,Fv:()=>n,Gf:()=>u,$T:()=>l,Y$:()=>a,tO:()=>c});var s=t(34717),o=t(53517);function i(e){let r;let t=new Date;if(e.always_active)return{valid:!0,qrCode:e,mode:"sign_in",message:"QR code is always active"};let s=e.week_start.toDate(),o=e.week_end.toDate();if(t<s||t>o)return{valid:!1,message:"QR code has expired",qrCode:e};let i=e.work_days.split(","),n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()];if(!i.includes(n))return{valid:!1,message:"QR code is not active on this day",qrCode:e};let a=100*t.getHours()+t.getMinutes(),d=Number.parseInt(e.signin_hour.replace(":","")),c=Number.parseInt(e.inactive_hour.replace(":","")),u=Number.parseInt(e.signout_hour.replace(":",""));return"inactive"==(r=a>=d&&a<c?"sign_in":a>=c&&a<u?"sign_out":"inactive")?{valid:!1,message:"QR code is not active at this time",qrCode:e}:{valid:!0,qrCode:e,mode:r,message:`Ready for ${"sign_in"===r?"sign in":"sign out"}`}}async function n(e){try{let r=(0,s.rJ)(o.db,"employees"),t=(0,s.P)(r,(0,s._M)("employee_id","==",e)),i=await (0,s.GG)(t);if(i.empty)return null;return{id:i.docs[0].id,...i.docs[0].data()}}catch(e){throw console.error("[v0] Error getting employee by ID:",e),e}}async function a(e,r){try{let t=(0,s.H9)(o.db,"employees",e);return await (0,s.mZ)(t,r),{success:!0}}catch(e){throw console.error("[v0] Error updating employee:",e),e}}async function d(){try{let e=(0,s.rJ)(o.db,"qr_codes"),r=(0,s.P)(e,(0,s.AB)(1)),t=await (0,s.GG)(r);if(console.log("getCurrentQRCode: querySnapshot.empty:",t.empty),console.log("getCurrentQRCode: querySnapshot.docs:",t.docs.map(e=>e.data())),t.empty)return console.log("getCurrentQRCode: No active QR code found in database."),{valid:!1,message:"No active QR code found"};let n={id:t.docs[0].id,...t.docs[0].data()},a=i(n);return console.log("getCurrentQRCode: Validation result:",a),{...a,qrCode:n}}catch(e){return console.error("[v0] Error getting current QR code:",e),{valid:!1,message:"Error validating QR code"}}}async function c(e){try{let r=(0,s.rJ)(o.db,"qr_codes"),t=(0,s.P)(r,(0,s._M)("code","==",e),(0,s._M)("is_active","==",!0)),n=await (0,s.GG)(t);if(n.empty)return{valid:!1,message:"Invalid or expired QR code"};let a={id:n.docs[0].id,...n.docs[0].data()};return i(a)}catch(e){return console.error("[v0] Error validating QR code:",e),{valid:!1,message:"Error validating QR code"}}}async function u(e){try{let r=(0,s.rJ)(o.db,"signin_out_records"),t={employee_id:e.employee_id,qr_code_id:e.qrCodeId,action_type:e.actionType,timestamp:s.Dc.now(),ip_address:e.ipAddress||"",device_info:e.deviceInfo||"",selfie_data:e.selfieData||""};return{lastID:(await (0,s.gS)(r,t)).id}}catch(e){throw console.error("[v0] Error recording sign in/out:",e),e}}async function p(e){try{let r=(0,s.H9)(o.db,"qr_codes",e);return await (0,s.kd)(r),{success:!0}}catch(e){throw console.error("[v0] Error deleting QR code:",e),e}}async function l(e,r){try{let t=(0,s.H9)(o.db,"qr_codes",e);return await (0,s.mZ)(t,{is_active:!r}),{success:!0}}catch(e){throw console.error("[v0] Error toggling QR code status:",e),e}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},53517:(e,r,t)=>{"use strict";t.d(r,{db:()=>d,j2:()=>c});var s=t(89579),o=t(34717),i=t(6333),n=t(1767);let a=(0,s.Wp)({apiKey:"AIzaSyAKy32t3h5bIC0T--o56m982hmeFBEbk0U",authDomain:"martinez-4ab8d.firebaseapp.com",projectId:"martinez-4ab8d",storageBucket:"martinez-4ab8d.firebasestorage.app",messagingSenderId:"79056089461",appId:"1:79056089461:web:e25bb5bf9b462e83ebe33c",measurementId:"G-W17EK3Z35K"}),d=(0,o.aU)(a);(0,i.c7)(a);let c=(0,n.xI)(a)},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73496:e=>{"use strict";e.exports=require("http2")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},90329:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>u,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{POST:()=>c});var o=t(96559),i=t(48088),n=t(37719),a=t(32190),d=t(44089);async function c(e){try{let{employeeId:r,actionType:t}=await e.json();if(!r||!t)return a.NextResponse.json({error:"Employee ID and action type are required"},{status:400});if(!["sign_in","sign_out"].includes(t))return a.NextResponse.json({error:"Invalid action type"},{status:400});let s=await (0,d.Fv)(r);if(!s)return a.NextResponse.json({error:"Employee not found"},{status:404});let o=await (0,d.On)();if(!o.valid||!("qrCode"in o)||!o.qrCode)return a.NextResponse.json({error:o.message||"Invalid QR code"},{status:400});let i=e.headers.get("x-forwarded-for")||"Unknown",n=e.headers.get("user-agent")||"Unknown";return await (0,d.Gf)({employee_id:s.employee_id,qrCodeId:o.qrCode.id,actionType:t,ipAddress:i,deviceInfo:n}),a.NextResponse.json({success:!0,message:`Successfully ${"sign_in"===t?"signed in":"signed out"}`})}catch(e){return console.error("[v0] Sign-in/out error:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/signin/route",pathname:"/api/signin",filename:"route",bundlePath:"app/api/signin/route"},resolvedPagePath:"/home/hack237/Pictures/Work/app/api/signin/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:l,serverHooks:g}=u;function y(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:l})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580,129],()=>t(90329));module.exports=s})();